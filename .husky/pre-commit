#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check for .env files in the staging area, but allow .env.example
if git diff --cached --name-only | grep -E '\.env($|\.[^e][^x][^a][^m][^p][^l][^e].*$)'; then
  echo "Error: Attempting to commit .env files (except .env.example). These files should not be committed."
  echo "Please remove them from your commit using: git reset HEAD <file>"
  exit 1
fi

echo "ğŸ” Running pre-commit checks..."

# Run client checks
echo "ğŸ“¦ Running client checks..."
cd client

# Run linting
echo "ğŸ“ Running ESLint..."
npm run lint:check || (echo "âŒ ESLint failed. Please fix the issues and try again." && exit 1)

# Run prettier check
echo "ğŸ’… Running Prettier check..."
npm run prettier-check || (echo "âŒ Prettier check failed. Please run 'npm run prettier' and try again." && exit 1)

# Run tests
echo "ğŸ§ª Running tests..."
npm run test:coverage || (echo "âŒ Tests failed. Please fix the failing tests and try again." && exit 1)

echo "âœ… All checks passed!" 